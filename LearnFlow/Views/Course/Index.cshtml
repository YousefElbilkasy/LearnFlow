@using System.Security.Claims
@model IEnumerable<LearnFlow.Models.Course>

@{
  ViewData["Title"] = "Index";
}

<section class="section courses" id="courses">
  <div class="container">
    <div class="row">
      <div class="col-lg-12 text-center">
        <div class="section-heading"></div>
        <h6>Latest Courses</h6>
        <h2>Latest Courses</h2>
      </div>
    </div>
  </div>
  <div class="row event_box">
    @foreach (var course in Model)
    {
      <a href="@Url.Action("Details", "Course", new { id = course.CourseId })"
        class="col-lg-4 col-md-6 align-self-center mb-30 event_outer col-md-6 design">
        <div class="">
          <div class="events_item">
            <div class="thumb">
              <img src="@course.ImageUrl" alt="">
              <span class="price">
                <h6 style="font-size: 1.1em;"><em>L.E</em>@course.Price</h6>
              </span>
            </div>
            <div class="down-content">
              <h4>@course.Title</h4>
              <h6>Instructor Name: @course.Instructor.FullName</h6>
              @if (course.Enrollments.Any())
              {
                <p>Enrollments Count: @course.Enrollments.Count</p>
              }
              else
              {
                <p>No enrollments yet</p>
              }
              @if (course.Reviews.Any())
              {
                <p>Average Rating: @course.Reviews.Average(r => r.Rating)</p>
              }
              else
              {
                <p>No reviews yet</p>
              }
              @{
                if (User.Identity.IsAuthenticated &&
                course.Enrollments.Any(e => e.StudentId.ToString() == User.FindFirstValue(ClaimTypes.NameIdentifier)))
                {
                }
                else
                {
                  <form asp-action="Enroll" asp-controller="Enrollment" method="get">
                    <input type="hidden" name="id" value="@course.CourseId" />
                    <button type="submit" class="btn btn-primary">Enroll Now</button>
                  </form>
                }
              }
            </div>
          </div>
        </div>
      </a>
    }
  </div>
  </div>
</section>
